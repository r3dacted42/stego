(function(){"use strict";self.onmessage=h=>{try{const{bitmap:a}=h.data,o=new OffscreenCanvas(a.width,a.height),l=o.getContext("2d");if(!l){self.postMessage({error:"failed to get OffscreenCanvas context"});return}l.drawImage(a,0,0),a.close();const r=l.getImageData(0,0,o.width,o.height).data,g=Math.floor(r.length/4)*3;if(g<32){self.postMessage({error:"image is too small to contain a message header."});return}const E=new Uint8Array(4);let e=0;for(let t=0;t<4;t++){let s=0;for(let i=0;i<8;i++){for(;e%4===3;)e++;if(e>=r.length){self.postMessage({error:"unexpected EOF while decoding header."});return}const c=r[e]&1;s=s<<1|c,e++}E[t]=s}const n=new DataView(E.buffer).getUint32(0,!1),f=g-32,m=n*8;if(n===0){self.postMessage({message:""});return}if(m>f){self.postMessage({error:`corrupted data: message length header is ${n} bytes, but only ${Math.floor(f/8)} bytes are available.`});return}const d=new Uint8Array(n);for(let t=0;t<n;t++){let s=0;for(let i=0;i<8;i++){for(;e%4===3;)e++;if(e>=r.length){self.postMessage({error:"unexpected EOF while decoding message."});return}const c=r[e]&1;s=s<<1|c,e++}d[t]=s}const w={message:new TextDecoder().decode(d)};self.postMessage(w)}catch(a){const o=a;self.postMessage({error:o.message})}}})();
