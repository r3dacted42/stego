(function(){"use strict";self.onmessage=w=>{try{const{bitmap:t,message:o}=w.data,r=new OffscreenCanvas(t.width,t.height),l=r.getContext("2d");if(!l){self.postMessage({error:"Failed to get OffscreenCanvas context"});return}l.drawImage(t,0,0),t.close();const c=l.getImageData(0,0,r.width,r.height),s=c.data,i=new TextEncoder().encode(o),h=i.length,n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,h,!1);const a=new Uint8Array(n.length+i.length);a.set(n,0),a.set(i,n.length);const y=a.length*8,E=Math.floor(s.length/4)*3;if(y>E){self.postMessage({error:`Message is too large (${h} bytes) for this image (max ${Math.floor(E/8)-4} bytes).`});return}let e=0;for(let g=0;g<a.length;g++){const x=a[g];for(let f=7;f>=0;f--){for(;e%4===3;)e++;if(e>=s.length)throw new Error("unexpected EOF");const M=x>>f&1,d=s[e];M===1?s[e]=d|1:s[e]=d&254,e++}}const m={imageData:c};self.postMessage(m,[c.data.buffer])}catch(t){const o=t;self.postMessage({error:o.message})}}})();
