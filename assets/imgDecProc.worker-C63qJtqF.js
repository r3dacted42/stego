(function(){"use strict";self.onmessage=h=>{try{const{bitmap:a}=h.data,o=new OffscreenCanvas(a.width,a.height),c=o.getContext("2d");if(!c){self.postMessage({error:"Failed to get OffscreenCanvas context"});return}c.drawImage(a,0,0),a.close();const r=c.getImageData(0,0,o.width,o.height).data,E=Math.floor(r.length/4)*3;if(E<32){self.postMessage({error:"Image is too small to contain a message header."});return}const g=new Uint8Array(4);let e=0;for(let t=0;t<4;t++){let s=0;for(let i=0;i<8;i++){for(;e%4===3;)e++;if(e>=r.length)throw new Error("unexpected EOF");const l=r[e]&1;s=s<<1|l,e++}g[t]=s}const n=new DataView(g.buffer).getUint32(0,!1),f=E-32,w=n*8;if(n===0){self.postMessage({message:""});return}if(w>f){self.postMessage({error:`Corrupted data: Message length header is ${n} bytes, but only ${Math.floor(f/8)} bytes are available.`});return}const d=new Uint8Array(n);for(let t=0;t<n;t++){let s=0;for(let i=0;i<8;i++){for(;e%4===3;)e++;if(e>=r.length)throw new Error("unexpected EOF");const l=r[e]&1;s=s<<1|l,e++}d[t]=s}const m={message:new TextDecoder().decode(d)};self.postMessage(m)}catch(a){const o=a;self.postMessage({error:o.message})}}})();
